apiVersion: apps/v1
kind: Deployment
metadata:
  name: kube-janitor
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kube-janitor
  template:
    metadata:
      labels:
        app: kube-janitor
    spec:
      serviceAccountName: kube-janitor
      containers:
        - name: kube-janitor
          image: kube-janitor:latest
          imagePullPolicy: IfNotPresent
          args:
            - "kube-janitor"
            - "--config"
            - "/app/config.yaml"
          volumeMounts:
            - name: config-volume
              mountPath: /app/config.yaml
              subPath: config.yaml

            - name: k3s-manifests
              mountPath: /manifests
              readOnly: true       

      volumes:
        - name: config-volume
          configMap:
            name: kube-janitor-config

        - name: k3s-manifests
          hostPath:
            path: /tmp/kube-janitor-manifests
            type: DirectoryOrCreate

